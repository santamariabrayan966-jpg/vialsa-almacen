<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${titulo}">Proveedores | VIALSA</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Tema general -->
    <link th:href="@{/css/theme.css}" rel="stylesheet">

    <!-- Tema exclusivo proveedores -->
    <link th:href="@{/css/proveedores.css}" rel="stylesheet">

    <!-- Bootstrap Table core -->
    <link rel="stylesheet"
          href="https://unpkg.com/bootstrap-table@1.22.2/dist/bootstrap-table.min.css">
</head>

<body>

<!-- HEADER -->
<div th:replace="~{fragments/header :: header}"></div>

<main class="container mt-5">

    <!-- Título -->
    <h2 class="page-title-vialsa">
        <i class="bi bi-truck"></i> Proveedores
    </h2>
    <p class="page-subtitle">Gestión de proveedores de vidrios, aluminios y accesorios</p>

    <!-- Botón Nuevo -->
    <div class="d-flex justify-content-end mb-3">
        <button id="btn-nuevo-proveedor" class="btn-vialsa-nuevo">
            <i class="bi bi-plus-lg"></i> Nuevo proveedor
        </button>
    </div>

    <!-- Tarjeta -->
    <div class="card card-proveedores">

        <div class="card-proveedores-header d-flex justify-content-between align-items-center">
            <span class="badge-soft">
                <i class="bi bi-people-fill me-1"></i>
                <span th:text="${#lists.size(proveedores)} + ' proveedor(es) activos'"></span>
            </span>

            <small class="text-light-50">
                <i class="bi bi-search"></i> Usa el buscador para filtrar proveedores
            </small>
        </div>

        <!-- TABLA -->
        <table
                id="tablaProveedores"
                class="table table-proveedores"
                data-toggle="table"
                data-search="true"
                data-search-highlight="true"
                data-pagination="true"
                data-page-size="8"
                data-page-list="[5,8,10,20]"
                data-locale="es-ES">

            <thead>
            <tr>
                <th data-field="id" data-sortable="true">#</th>
                <th data-field="nombre" data-sortable="true">Nombre</th>
                <th data-field="documento">Documento</th>
                <th data-field="telefono" data-sortable="true">Teléfono</th>
                <th data-field="correo">Correo</th>
                <th data-field="direccion">Dirección</th>
                <th data-field="estado">Estado</th>
                <th data-field="acciones">Acciones</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="prov, iter : ${proveedores}">

                <!-- N° correlativo -->
                <td th:text="${iter.index + 1}"></td>

                <!-- Nombre -->
                <td class="fw-semibold" th:text="${prov.nombreProveedor}">Proveedor</td>

                <!-- Documento -->
                <td>
                    <span class="badge-doc" th:text="${prov.nroDocumento}">00000000</span>
                </td>

                <!-- Teléfono -->
                <td th:text="${prov.telefono}">---</td>

                <!-- Correo -->
                <td th:text="${prov.correo}">---</td>

                <!-- Dirección -->
                <td th:text="${prov.direccion}">---</td>

                <!-- Estado -->
                <td>
        <span th:if="${prov.activo}"
              class="badge-estado badge-estado-activo">ACTIVO</span>
                    <span th:if="${!prov.activo}"
                          class="badge-estado badge-estado-inactivo">INACTIVO</span>
                </td>

                <!-- Acciones -->
                <td class="text-nowrap">

                    <!-- Ver detalle -->
                    <button class="btn-icon-circle btn-ver-proveedor me-1"
                            th:data-id="${prov.idProveedor}"
                            data-bs-toggle="tooltip"
                            title="Ver proveedor">
                        <i class="bi bi-eye-fill"></i>
                    </button>

                    <!-- Activar / Desactivar -->
                    <button class="btn-icon-circle btn-estado-proveedor me-1"
                            th:data-id="${prov.idProveedor}"
                            th:data-activo="${prov.activo}"
                            data-bs-toggle="tooltip"
                            th:title="${prov.activo} ? 'Desactivar proveedor' : 'Activar proveedor'">

                        <i class="bi"
                           th:classappend="${prov.activo}
                   ? ' bi-toggle-on text-success'
                   : ' bi-toggle-off text-secondary'">
                        </i>
                    </button>

                    <!-- Editar -->
                    <button class="btn-icon-circle btn-editar-proveedor me-1"
                            th:data-id="${prov.idProveedor}"
                            data-bs-toggle="tooltip"
                            title="Editar proveedor">
                        <i class="bi bi-pencil"></i>
                    </button>

                    <!-- Eliminar -->
                    <button class="btn-icon-circle btn-eliminar-proveedor"
                            th:data-nombre="${prov.nombreProveedor}"
                            th:data-url="@{'/proveedores/eliminar/' + ${prov.idProveedor}}"
                            data-bs-toggle="tooltip"
                            title="Eliminar proveedor">
                        <i class="bi bi-trash"></i>
                    </button>


                </td>

            </tr>
            </tbody>


        </table>

    </div>
</main>

<!-- PANEL LATERAL / DRAWER DETALLE PROVEEDOR -->
<div class="offcanvas offcanvas-end offcanvas-proveedor" tabindex="-1" id="offcanvasProveedor">
    <div class="offcanvas-header">
        <div>
            <h5 class="offcanvas-title mb-0">
                <i class="bi bi-truck-front-fill me-1"></i>
                <span id="det-nombre">Proveedor</span>
            </h5>
            <small class="text-light" id="det-documento"></small>
        </div>
        <button type="button" class="btn-close btn-close-white text-reset" data-bs-dismiss="offcanvas"
                aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body">

        <!-- Estado toggle dentro del panel -->
        <div class="d-flex align-items-center justify-content-between mb-3">
            <span class="fw-semibold">Estado</span>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox"
                       id="det-activo-toggle">
                <label class="form-check-label" for="det-activo-toggle"
                       id="det-activo-label">Activo</label>
            </div>
        </div>

        <hr>

        <dl class="row small mb-3">
            <dt class="col-4 text-muted">Teléfono</dt>
            <dd class="col-8" id="det-telefono">-</dd>

            <dt class="col-4 text-muted">Correo</dt>
            <dd class="col-8" id="det-correo">-</dd>

            <dt class="col-4 text-muted">Dirección</dt>
            <dd class="col-8" id="det-direccion">-</dd>
        </dl>

        <div class="alert alert-info py-2 small mb-3">
            <i class="bi bi-info-circle me-1"></i>
            Más adelante aquí puedes mostrar el <strong>historial de compras</strong> de este proveedor.
        </div>

        <button type="button"
                class="btn btn-outline-primary w-100 mb-2"
                id="btn-ver-compras-proveedor">
            <i class="bi bi-receipt-cutoff me-1"></i>
            Ver historial de compras
        </button>

        <small class="text-muted d-block">
            * En desarrollo: conecta este botón a tu módulo de compras / órdenes de compra.
        </small>

    </div>
</div>

<!-- MODAL NUEVO / EDITAR PROVEEDOR -->
<div class="modal fade modal-proveedor" id="modalProveedor">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="titulo-modal-proveedor">Nuevo proveedor</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <form th:action="@{/proveedores/guardar}" method="post" id="form-proveedor">

                <div class="modal-body">

                    <input type="hidden" name="idProveedor" id="prov-idProveedor">

                    <!-- Documento -->
                    <div class="mb-3">
                        <label class="form-label">N° Documento (DNI o RUC)</label>

                        <div class="input-group">
                            <input class="form-control"
                                   id="prov-nroDocumento"
                                   name="nroDocumento"
                                   maxlength="20"
                                   placeholder="DNI: 8 dígitos | RUC: 11 dígitos"
                                   required>

                            <button class="btn btn-outline-primary" type="button" id="btn-buscar-doc"
                                    title="Consultar datos automáticamente">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Nombre / Razón social -->
                    <div class="mb-3">
                        <label class="form-label">Nombre / Razón Social</label>
                        <input class="form-control"
                               id="prov-nombreProveedor"
                               name="nombreProveedor"
                               required
                               maxlength="100">
                    </div>

                    <!-- Teléfono -->
                    <div class="mb-3">
                        <label class="form-label">Teléfono</label>
                        <input class="form-control"
                               id="prov-telefono"
                               name="telefono"
                               maxlength="20">
                    </div>

                    <!-- Correo -->
                    <div class="mb-3">
                        <label class="form-label">Correo</label>
                        <input class="form-control"
                               id="prov-correo"
                               name="correo"
                               type="email"
                               maxlength="100">
                    </div>

                    <!-- Dirección -->
                    <div class="mb-1">
                        <label class="form-label">Dirección</label>
                        <input class="form-control"
                               id="prov-direccion"
                               name="direccion"
                               maxlength="150">
                    </div>

                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal">Cancelar</button>

                    <button class="btn btn-vialsa-nuevo" type="submit">
                        <i class="bi bi-save"></i> Guardar
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- FOOTER -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- JS: jQuery (requerido por Bootstrap Table) -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- JS: Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JS: Bootstrap Table -->
<script src="https://unpkg.com/bootstrap-table@1.22.2/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.22.2/dist/locale/bootstrap-table-es-ES.min.js"></script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- JS propio -->
<script th:src="@{/js/proveedores.js}"></script>

</body>
</html>
