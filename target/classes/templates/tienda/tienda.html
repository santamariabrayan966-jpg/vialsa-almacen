<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title th:text="${titulo}">Tienda VIALSA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/tienda.css}">

</head>
<body>

<!-- HEADER -->
<header th:replace="~{fragments/header-tienda :: headerTienda}"></header>

<!-- LOGIN / REGISTRO MODAL -->
<div th:replace="~{fragments/login-modal :: loginModal}"></div>

<!-- CONTENIDO -->
<div class="container mt-4">

    <h3 class="mb-3">Productos destacados</h3>

    <div class="row g-3">

        <div class="col-6 col-md-3"
             th:each="p : ${productos}">

            <div class="card product-card h-100">

                <img class="card-img-top"
                     th:src="${p.foto != null} ?
        @{/img/productos/{f}(f=${p.foto})} :
        @{/img/productos/default.png}">



                <div class="card-body">

                    <h6 class="card-title"
                        th:text="${p.nombreProducto}"></h6>

                    <p class="product-price"
                       th:text="${#numbers.formatDecimal(p.precioUnitario,1,'POINT',2,'POINT')}">
                    </p>

                    <a th:href="@{'/producto/' + ${p.idProducto}}"
                       class="btn btn-sm btn-primary w-100 mt-2">
                        Ver detalle
                    </a>

                </div>
            </div>
        </div>

        <div class="col-12"
             th:if="${productos == null or #lists.isEmpty(productos)}">
            <p class="text-muted">Pronto verás aquí productos.</p>
        </div>

    </div>
</div>
<!-- JS (Bootstrap SIEMPRE primero) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Luego tus scripts -->
<script th:src="@{/js/login.js}"></script>
<script th:src="@{/js/tienda.js}"></script>

<!-- AUTO-ABRIR LOGIN CUANDO HAY ERROR -->
<script th:if="${param.error} or ${param.disabled} or ${param.login}">
    document.addEventListener("DOMContentLoaded", function () {
        const modal = new bootstrap.Modal(document.getElementById("loginModal"));
        modal.show();
        mostrarLogin();
    });
</script>

<!-- AUTO-ABRIR REGISTRO SI VIENE DESDE EL CONTROLADOR -->
<script th:if="${mostrarRegistro}">
    document.addEventListener("DOMContentLoaded", function () {
        const modal = new bootstrap.Modal(document.getElementById("loginModal"));
        modal.show();
        mostrarRegistro();
    });
</script>


</body>
</html>
