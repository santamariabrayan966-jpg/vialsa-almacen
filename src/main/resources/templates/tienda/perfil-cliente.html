<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Mi Perfil | VIALSA</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- CSS general de la tienda -->
    <link rel="stylesheet" th:href="@{/css/tienda.css}">
    <link rel="stylesheet" th:href="@{/css/header-tienda.css}">

    <style>
        .profile-card {
            max-width: 750px;
            margin: auto;
            border-radius: 18px;
            padding: 40px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .profile-photo {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #e3e3e3;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .save-btn {
            padding: 10px;
            font-size: 1rem;
        }
    </style>
</head>

<body>

<header th:replace="~{fragments/header-tienda :: headerTienda}"></header>

<div class="container mt-5">

    <h3 class="fw-bold mb-4">
        <i class="bi bi-person-circle me-2"></i> Mi Perfil
    </h3>

    <div class="profile-card">

        <div class="text-center mb-4">
            <img th:if="${usuario.foto != null}"
                 th:src="@{|/uploads/usuarios/${usuario.foto}|}"
                 class="profile-photo">

            <img th:if="${usuario.foto == null}"
                 src="/images/default-user.png"
                 class="profile-photo">
        </div>

        <form th:action="@{/tienda/perfil/actualizar}"
              th:object="${usuario}"
              method="post">

            <!-- CSRF -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <input type="hidden" th:field="*{idUsuario}"/>

            <!-- DATOS -->
            <div class="section-title"><i class="bi bi-person-lines-fill me-1"></i> Datos personales</div>

            <div class="mb-3">
                <label class="form-label">Nombres</label>
                <input type="text" th:field="*{nombres}" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Apellidos</label>
                <input type="text" th:field="*{apellidos}" class="form-control" required>
            </div>

            <div class="section-title"><i class="bi bi-envelope-fill me-1"></i> Contacto</div>

            <div class="mb-3">
                <label class="form-label">Correo</label>
                <input type="email" th:field="*{correo}" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Teléfono</label>
                <input type="text" th:field="*{telefono}" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label">Dirección</label>
                <input type="text" th:field="*{direccion}" class="form-control">
            </div>

            <div class="section-title"><i class="bi bi-key-fill me-1"></i> Cambiar contraseña (opcional)</div>

            <div class="mb-3">
                <label class="form-label">Nueva contraseña</label>
                <input type="password" name="nuevaContrasena" class="form-control"
                       placeholder="Déjalo vacío para no cambiarla">
            </div>

            <div class="mb-3">
                <label class="form-label">Confirmar contraseña</label>
                <input type="password" name="confirmarContrasena" class="form-control">
            </div>

            <div th:if="${param.errorPass}" class="alert alert-danger py-2">
                Las contraseñas no coinciden o no son válidas.
            </div>

            <button class="btn btn-primary w-100 save-btn">
                <i class="bi bi-check-circle me-1"></i> Guardar Cambios
            </button>

            <div th:if="${param.exito}" class="alert alert-success mt-3 mb-0">
                ¡Datos actualizados con éxito!
            </div>
        </form>

    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
