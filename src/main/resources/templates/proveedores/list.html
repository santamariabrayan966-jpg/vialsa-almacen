<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${titulo}">Proveedores | VIALSA</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Tema general -->
    <link th:href="@{/css/theme.css}" rel="stylesheet">

    <style>
        /* Modal pequeño y centrado */
        .modal-proveedor-pequeno .modal-dialog {
            max-width: 520px;
        }
    </style>
</head>

<body class="bg-light d-flex flex-column min-vh-100">

<!-- Encabezado -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- Contenido principal -->
<main class="container-fluid mt-5 px-4 flex-grow-1">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-danger m-0">
            <i class="bi bi-truck"></i> Proveedores
        </h2>

        <!-- AHORA: botón que abre modal, NO navega -->
        <button type="button" class="btn btn-success shadow-sm" id="btn-nuevo-proveedor">
            <i class="bi bi-plus-lg"></i> Nuevo proveedor
        </button>
    </div>

    <!-- Mensajes -->
    <div th:if="${success != null and !#strings.isEmpty(success)}"
         class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span th:text="${success}">Operación exitosa.</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
    </div>
    <div th:if="${error != null and !#strings.isEmpty(error)}"
         class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span th:text="${error}">Ocurrió un error.</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
    </div>

    <!-- Tabla de proveedores -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0 text-center">
                <thead class="table-primary">
                <tr>
                    <th style="width: 60px;">#</th>
                    <th>Nombre</th>
                    <th>Documento</th>
                    <th>Teléfono</th>
                    <th>Correo</th>
                    <th>Dirección</th>
                    <th style="width: 150px;">Acciones</th>
                </tr>
                </thead>

                <!-- Si hay proveedores -->
                <tbody th:if="${proveedores != null and !#lists.isEmpty(proveedores)}">
                <tr th:each="prov : ${proveedores}">
                    <td th:text="${prov.idProveedor}">1</td>
                    <td th:text="${prov.nombreProveedor}">Proveedor X</td>
                    <td th:text="${prov.nroDocumento}">123456789</td>
                    <td th:text="${prov.telefono}">987654321</td>
                    <td th:text="${prov.correo}">correo@proveedor.com</td>
                    <td th:text="${prov.direccion}">Av. Principal 123</td>
                    <td>
                        <!-- EDITAR: abre modal pequeño -->
                        <button type="button"
                                class="btn btn-warning btn-sm me-1 btn-editar-proveedor"
                                th:data-id="${prov.idProveedor}">
                            <i class="bi bi-pencil-square"></i>
                        </button>

                        <!-- ELIMINAR: SweetAlert -->
                        <a class="btn btn-danger btn-sm btn-eliminar-proveedor"
                           th:href="@{'/proveedores/eliminar/' + ${prov.idProveedor}}"
                           th:data-nombre="${prov.nombreProveedor}">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                </tr>
                </tbody>

                <!-- Si NO hay proveedores -->
                <tbody th:if="${proveedores == null or #lists.isEmpty(proveedores)}">
                <tr>
                    <td colspan="7" class="text-center text-muted py-4">
                        <i class="bi bi-exclamation-triangle"></i>
                        No hay proveedores registrados.
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- MODAL PEQUEÑO NUEVO / EDITAR PROVEEDOR -->
<div class="modal fade modal-proveedor-pequeno" id="modalProveedor" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="titulo-modal-proveedor">
                    <i class="bi bi-truck me-2"></i> Nuevo proveedor
                </h5>
                <button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <form th:action="@{/proveedores/guardar}" method="post" id="form-proveedor">
                <div class="modal-body">

                    <!-- id oculto (para editar) -->
                    <input type="hidden" name="idProveedor" id="prov-idProveedor"/>

                    <!-- Documento + botón API -->
                    <div class="mb-3">
                        <label class="form-label">N° Documento (RUC / DNI)</label>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control"
                                   name="nroDocumento" id="prov-nroDocumento"
                                   placeholder="Ej: 20123456789" maxlength="20">
                            <button class="btn btn-outline-secondary"
                                    type="button" id="btn-buscar-doc-proveedor">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            Usa la API para completar razón social / dirección.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Nombre / Razón social</label>
                        <input type="text" class="form-control"
                               name="nombreProveedor" id="prov-nombreProveedor"
                               placeholder="Ej: Vidrios S.A.C." required maxlength="100">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Teléfono</label>
                        <input type="text" class="form-control"
                               name="telefono" id="prov-telefono"
                               placeholder="Ej: 987654321" maxlength="20">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Correo electrónico</label>
                        <input type="email" class="form-control"
                               name="correo" id="prov-correo"
                               placeholder="Ej: contacto@empresa.com" maxlength="100">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-control"
                               name="direccion" id="prov-direccion"
                               placeholder="Ej: Jr. Los Vidrios 123 - Lima" maxlength="150">
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary"
                            data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-save"></i> Guardar
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Pie de página -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- JS de terceros -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- JS propio -->
<script th:src="@{/js/app.js}"></script>
<script th:src="@{/js/proveedores.js}"></script>
<script th:src="@{/js/navbar.js}"></script>

</body>
</html>
