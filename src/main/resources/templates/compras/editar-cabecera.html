<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title th:text="${titulo}">Editar Cabecera | VIALSA</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/theme.css}">
</head>
<body class="bg-light">

<main class="container-fluid py-3">
    <h5 class="text-primary mb-3">
        <i class="bi bi-pencil-square"></i> Editar cabecera de compra
    </h5>

    <!-- usa compraForm como objeto -->
    <form th:action="@{/compras/actualizar-cabecera}" th:object="${compraForm}" method="post">

        <!-- id oculto -->
        <input type="hidden" th:field="*{idCompra}" />

        <div class="row g-3 mb-3">
            <!-- PROVEEDOR (editable solo si BORRADOR) -->
            <div class="col-md-4">
                <label class="form-label fw-semibold">Proveedor</label>
                <select th:field="*{idProveedor}"
                        class="form-select"
                        th:disabled="${compraForm.estado} != 'BORRADOR'">
                    <option value="">Seleccione...</option>
                    <option th:each="prov : ${proveedores}"
                            th:value="${prov.idProveedor}"
                            th:text="${prov.nombreProveedor}">
                    </option>
                </select>
                <div class="form-text">
                    <span th:if="${compraForm.estado} == 'BORRADOR'">
                        Puede cambiar el proveedor porque la compra es un BORRADOR.
                    </span>
                    <span th:if="${compraForm.estado} != 'BORRADOR'">
                        El proveedor no se puede cambiar (documento ya registrado).
                    </span>
                </div>
            </div>

            <!-- TIPO COMPROBANTE -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Tipo Comprobante</label>
                <input type="text"
                       th:field="*{tipoComprobante}"
                       class="form-control"
                       th:disabled="${compraForm.estado} != 'BORRADOR'">
            </div>

            <!-- SERIE -->
            <div class="col-md-2">
                <label class="form-label fw-semibold">Serie</label>
                <input type="text"
                       th:field="*{serie}"
                       class="form-control"
                       th:disabled="${compraForm.estado} != 'BORRADOR'">
            </div>

            <!-- NUMERO -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Número</label>
                <input type="text"
                       th:field="*{numero}"
                       class="form-control"
                       th:disabled="${compraForm.estado} != 'BORRADOR'">
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-md-3">
                <label class="form-label fw-semibold">Forma de pago</label>
                <select th:field="*{formaPago}" class="form-select" id="formaPago">
                    <option value="CONTADO">CONTADO</option>
                    <option value="CREDITO">CRÉDITO</option>
                    <option value="TRANSFERENCIA">TRANSFERENCIA</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label fw-semibold">Plazo (días)</label>
                <input type="number"
                       min="0"
                       th:field="*{plazoDias}"
                       id="plazoDias"
                       class="form-control" />
            </div>

            <div class="col-md-2">
                <label class="form-label fw-semibold">N° Cuotas</label>
                <input type="number"
                       min="1"
                       th:field="*{numeroCuotas}"
                       id="numeroCuotas"
                       class="form-control" />
            </div>

            <div class="col-md-2">
                <label class="form-label fw-semibold">N° Orden compra</label>
                <input type="text"
                       th:field="*{nroOrdenCompra}"
                       class="form-control" />
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">N° Guía remisión</label>
                <input type="text"
                       th:field="*{nroGuiaRemision}"
                       class="form-control" />
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Observaciones</label>
            <textarea th:field="*{observaciones}"
                      class="form-control"
                      rows="3"
                      placeholder="Notas adicionales, condiciones especiales, etc."></textarea>
        </div>

        <div class="text-end">
            <button type="submit" class="btn btn-primary btn-sm">
                <i class="bi bi-save"></i> Guardar cambios
            </button>
        </div>
    </form>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Deshabilitar plazo/cuotas si formaPago = CONTADO
    document.addEventListener("DOMContentLoaded", function () {
        const formaPago = document.getElementById("formaPago");
        const plazoDias = document.getElementById("plazoDias");
        const numeroCuotas = document.getElementById("numeroCuotas");

        function actualizarCondicionesPago() {
            if (formaPago.value === "CONTADO") {
                plazoDias.value = "";
                numeroCuotas.value = "";
                plazoDias.disabled = true;
                numeroCuotas.disabled = true;
            } else {
                plazoDias.disabled = false;
                numeroCuotas.disabled = false;
            }
        }

        formaPago.addEventListener("change", actualizarCondicionesPago);
        actualizarCondicionesPago();
    });
</script>

</body>
</html>
