<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle de Venta</title>

    <!-- SOLO Bootstrap para que no duplique estilos del layout principal -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f8f9fa;
            font-size: 15px;
        }
        .card {
            border-radius: 10px;
        }
        .table th {
            background: #dbeafe !important;
        }
    </style>
</head>

<body>

<div class="container py-3">

    <!-- TÍTULO -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="text-danger fw-bold m-0">
            <i class="bi bi-receipt-cutoff"></i> Detalle de Venta
        </h4>

        <!-- Cerrar modal -->
        <button type="button" class="btn btn-secondary" onclick="window.parent.cerrarModalVenta()">
            <i class="bi bi-x-lg"></i> Cerrar
        </button>
    </div>

    <!-- INFORMACIÓN GENERAL -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">

            <div class="row g-3">

                <div class="col-md-6">
                    <p><strong>Cliente:</strong>
                        <span th:text="${venta.nombreCliente}"></span>
                    </p>

                    <p><strong>Tipo Comprobante:</strong>
                        <span th:text="${venta.tipoComprobante}"></span>
                    </p>

                    <p><strong>N° Comprobante:</strong>
                        <span th:text="${venta.nroComprobante}"></span>
                    </p>
                </div>

                <div class="col-md-6">
                    <p><strong>Fecha:</strong>
                        <span th:text="${#temporals.format(venta.fechaVenta,'dd/MM/yyyy HH:mm')}"></span>
                    </p>

                    <p><strong>Total Venta:</strong>
                        S/
                        <span th:text="${#numbers.formatDecimal(venta.totalVenta,2,'COMMA',2,'POINT')}"></span>
                    </p>

                    <p><strong>Estado:</strong>
                        <span class="badge bg-success" th:if="${venta.estadoVenta=='COMPLETADA'}">COMPLETADA</span>
                        <span class="badge bg-secondary" th:if="${venta.estadoVenta=='BORRADOR'}">BORRADOR</span>
                        <span class="badge bg-warning text-dark" th:if="${venta.estadoVenta=='CREDITO'}">CRÉDITO</span>
                        <span class="badge bg-danger" th:if="${venta.estadoVenta=='ANULADA'}">ANULADA</span>
                    </p>
                </div>

            </div>
        </div>
    </div>

    <!-- DETALLE -->
    <h5 class="fw-bold text-primary mb-3">
        <i class="bi bi-cart-check"></i> Productos Vendidos
    </h5>

    <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle text-center">

            <thead class="table-primary fw-bold">
            <tr>
                <th>Producto</th>
                <th>Unidad</th>
                <th>Cantidad</th>
                <th>Precio Unitario (S/)</th>
                <th>Descuento (S/)</th>
                <th>Subtotal (S/)</th>
            </tr>
            </thead>

            <tbody>

            <tr th:each="d : ${detalles}">
                <td th:text="${d.nombreProducto}"></td>

                <td th:text="${d.nombreUnidad}"></td>

                <td th:text="${#numbers.formatDecimal(d.cantidad,2,'COMMA',2,'POINT')}"></td>

                <td th:text="${#numbers.formatDecimal(d.precioUnitario,2,'COMMA',2,'POINT')}"></td>

                <td th:text="${#numbers.formatDecimal(d.descuento,2,'COMMA',2,'POINT')}"></td>

                <td th:text="${#numbers.formatDecimal(
                        (d.cantidad * d.precioUnitario) - (d.descuento != null ? d.descuento : 0),
                        2,'COMMA',2,'POINT'
                )}"></td>
            </tr>

            </tbody>

            <tfoot class="table-light fw-bold">
            <tr>
                <td colspan="5" class="text-end">TOTAL:</td>
                <td th:text="${#numbers.formatDecimal(venta.totalVenta,2,'COMMA',2,'POINT')}"></td>
            </tr>
            </tfoot>

        </table>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
