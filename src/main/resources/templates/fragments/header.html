<header th:fragment="header"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <nav class="navbar navbar-expand-lg navbar-dark shadow-sm"
         style="background: linear-gradient(90deg, #283E81, #A73C3C);">

        <div class="container-fluid">

            <!-- LOGO -->
            <a class="navbar-brand fw-bold text-white d-flex align-items-center" th:href="@{/}">
                <i class="bi bi-box-seam fs-4 me-2"></i>
                VIALSA
            </a>

            <!-- BOTÓN MOBILE -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#menuPrincipal">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- MENÚ -->
            <div class="collapse navbar-collapse" id="menuPrincipal">

                <ul class="navbar-nav ms-auto align-items-lg-center">

                    <!-- ========================================================= -->
                    <!-- GESTIÓN -->
                    <!-- ========================================================= -->
                    <li class="nav-item dropdown dropdown-hover"
                        th:if="${permisosUsuario['productos']}
                               or ${permisosUsuario['inventario']}
                               or ${permisosUsuario['proveedores']}">

                        <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                           data-bs-toggle="dropdown">
                            <i class="bi bi-gear"></i> Gestión
                        </a>

                        <ul class="dropdown-menu shadow">

                            <li th:if="${permisosUsuario['productos']}">
                                <a class="dropdown-item" th:href="@{/productos}">
                                    <i class="bi bi-bag"></i> Productos
                                </a>
                            </li>

                            <li th:if="${permisosUsuario['inventario']}">
                                <a class="dropdown-item" th:href="@{/inventario}">
                                    <i class="bi bi-box-seam"></i> Inventario
                                </a>
                            </li>

                            <li th:if="${permisosUsuario['proveedores']}">
                                <a class="dropdown-item" th:href="@{/proveedores}">
                                    <i class="bi bi-truck"></i> Proveedores
                                </a>
                            </li>

                        </ul>
                    </li>

                    <!-- ========================================================= -->
                    <!-- TRANSACCIONES -->
                    <!-- ========================================================= -->
                    <li class="nav-item dropdown dropdown-hover"
                        th:if="${permisosUsuario['compras']}
                               or ${permisosUsuario['ventas']}">

                        <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                           data-bs-toggle="dropdown">
                            <i class="bi bi-cash-stack"></i> Transacciones
                        </a>

                        <ul class="dropdown-menu shadow">

                            <li th:if="${permisosUsuario['compras']}">
                                <a class="dropdown-item" th:href="@{/compras}">
                                    <i class="bi bi-cart"></i> Compras
                                </a>
                            </li>

                            <li th:if="${permisosUsuario['ventas']}">
                                <a class="dropdown-item" th:href="@{/ventas}">
                                    <i class="bi bi-receipt"></i> Ventas
                                </a>
                            </li>

                        </ul>
                    </li>

                    <!-- ========================================================= -->
                    <!-- USUARIOS -->
                    <!-- ========================================================= -->
                    <li class="nav-item dropdown dropdown-hover"
                        th:if="${permisosUsuario['usuarios']}
                               or ${permisosUsuario['roles']}
                               or ${permisosUsuario['clientes']}">

                        <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                           data-bs-toggle="dropdown">
                            <i class="bi bi-people"></i> Usuarios
                        </a>

                        <ul class="dropdown-menu shadow">

                            <li th:if="${permisosUsuario['usuarios']}">
                                <a class="dropdown-item" th:href="@{/usuarios}">
                                    <i class="bi bi-person-badge"></i> Gestión de usuarios
                                </a>
                            </li>

                            <li th:if="${permisosUsuario['roles']}">
                                <a class="dropdown-item" th:href="@{/roles}">
                                    <i class="bi bi-shield-lock"></i> Roles
                                </a>
                            </li>

                            <li th:if="${permisosUsuario['clientes']}">
                                <a class="dropdown-item" th:href="@{/clientes}">
                                    <i class="bi bi-people-fill"></i> Clientes
                                </a>
                            </li>

                        </ul>
                    </li>

                    <!-- ========================================================= -->
                    <!-- ANÁLISIS -->
                    <!-- ========================================================= -->
                    <li class="nav-item" th:if="${permisosUsuario['dashboard']}">
                        <a class="nav-link text-white" th:href="@{/dashboard}">
                            <i class="bi bi-speedometer2"></i> Análisis
                        </a>
                    </li>

                    <!-- TIENDA (pública) -->
                    <li class="nav-item">
                        <a class="nav-link text-white" th:href="@{/tienda}">
                            <i class="bi bi-shop"></i> Tienda
                        </a>
                    </li>

                    <!-- USUARIO LOGUEADO -->
                    <li class="nav-item ms-lg-3 d-flex align-items-center" sec:authorize="isAuthenticated()">
                        <span class="text-white fw-semibold d-flex align-items-center">
                            <i class="bi bi-person-circle fs-5 me-1"></i>
                            <span sec:authentication="name"></span>
                        </span>
                    </li>

                    <!-- CERRAR SESIÓN -->
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <form th:action="@{/logout}" method="post" class="d-inline">
                            <button class="btn btn-link nav-link text-danger fw-semibold">
                                <i class="bi bi-box-arrow-right"></i> Cerrar sesión
                            </button>
                        </form>
                    </li>

                </ul>

            </div>
        </div>
    </nav>

</header>
